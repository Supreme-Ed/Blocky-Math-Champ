{
  "version": 3,
  "sources": ["../../../dev/core/src/Materials/Textures/Loaders/ddsTextureLoader.ts"],
  "sourcesContent": ["import type { Nullable } from \"../../../types\";\r\nimport { SphericalPolynomial } from \"../../../Maths/sphericalPolynomial\";\r\nimport type { InternalTexture } from \"../../../Materials/Textures/internalTexture\";\r\nimport type { IInternalTextureLoader } from \"./internalTextureLoader\";\r\nimport type { DDSInfo } from \"../../../Misc/dds\";\r\nimport { DDSTools } from \"../../../Misc/dds\";\r\n\r\nimport type { Engine } from \"core/Engines/engine\";\r\n\r\n/**\r\n * Implementation of the DDS Texture Loader.\r\n * @internal\r\n */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport class _DDSTextureLoader implements IInternalTextureLoader {\r\n    /**\r\n     * Defines whether the loader supports cascade loading the different faces.\r\n     */\r\n    public readonly supportCascades = true;\r\n\r\n    /**\r\n     * Uploads the cube texture data to the WebGL texture. It has already been bound.\r\n     * @param imgs contains the cube maps\r\n     * @param texture defines the BabylonJS internal texture\r\n     * @param createPolynomials will be true if polynomials have been requested\r\n     * @param onLoad defines the callback to trigger once the texture is ready\r\n     */\r\n    public loadCubeData(imgs: ArrayBufferView | ArrayBufferView[], texture: InternalTexture, createPolynomials: boolean, onLoad: Nullable<(data?: any) => void>): void {\r\n        const engine = texture.getEngine() as Engine;\r\n        let info: DDSInfo | undefined;\r\n        let loadMipmap: boolean = false;\r\n        let maxLevel: number = 1000;\r\n        if (Array.isArray(imgs)) {\r\n            for (let index = 0; index < imgs.length; index++) {\r\n                const data = imgs[index];\r\n                info = DDSTools.GetDDSInfo(data);\r\n\r\n                texture.width = info.width;\r\n                texture.height = info.height;\r\n\r\n                loadMipmap = (info.isRGB || info.isLuminance || info.mipmapCount > 1) && texture.generateMipMaps;\r\n\r\n                engine._unpackFlipY(info.isCompressed);\r\n\r\n                DDSTools.UploadDDSLevels(engine, texture, data, info, loadMipmap, 6, -1, index);\r\n\r\n                if (!info.isFourCC && info.mipmapCount === 1) {\r\n                    engine.generateMipMapsForCubemap(texture);\r\n                } else {\r\n                    maxLevel = info.mipmapCount - 1;\r\n                }\r\n            }\r\n        } else {\r\n            const data = imgs;\r\n            info = DDSTools.GetDDSInfo(data);\r\n\r\n            texture.width = info.width;\r\n            texture.height = info.height;\r\n\r\n            if (createPolynomials) {\r\n                info.sphericalPolynomial = new SphericalPolynomial();\r\n            }\r\n\r\n            loadMipmap = (info.isRGB || info.isLuminance || info.mipmapCount > 1) && texture.generateMipMaps;\r\n            engine._unpackFlipY(info.isCompressed);\r\n\r\n            DDSTools.UploadDDSLevels(engine, texture, data, info, loadMipmap, 6);\r\n\r\n            if (!info.isFourCC && info.mipmapCount === 1) {\r\n                // Do not unbind as we still need to set the parameters.\r\n                engine.generateMipMapsForCubemap(texture, false);\r\n            } else {\r\n                maxLevel = info.mipmapCount - 1;\r\n            }\r\n        }\r\n        engine._setCubeMapTextureParams(texture, loadMipmap, maxLevel);\r\n        texture.isReady = true;\r\n        texture.onLoadedObservable.notifyObservers(texture);\r\n        texture.onLoadedObservable.clear();\r\n\r\n        if (onLoad) {\r\n            onLoad({ isDDS: true, width: texture.width, info, data: imgs, texture });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Uploads the 2D texture data to the WebGL texture. It has already been bound once in the callback.\r\n     * @param data contains the texture data\r\n     * @param texture defines the BabylonJS internal texture\r\n     * @param callback defines the method to call once ready to upload\r\n     */\r\n    public loadData(\r\n        data: ArrayBufferView,\r\n        texture: InternalTexture,\r\n        callback: (width: number, height: number, loadMipmap: boolean, isCompressed: boolean, done: () => void) => void\r\n    ): void {\r\n        const info = DDSTools.GetDDSInfo(data);\r\n\r\n        const loadMipmap = (info.isRGB || info.isLuminance || info.mipmapCount > 1) && texture.generateMipMaps && Math.max(info.width, info.height) >> (info.mipmapCount - 1) === 1;\r\n        callback(info.width, info.height, loadMipmap, info.isFourCC, () => {\r\n            DDSTools.UploadDDSLevels(texture.getEngine(), texture, data, info, loadMipmap, 1);\r\n        });\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;AACA,IAaa;AAbb;;;AAIA;AASM,IAAO,oBAAP,MAAwB;MAA9B,cAAA;AAIoB,aAAA,kBAAkB;MAqFtC;;;;;;;;MA5EW,aAAa,MAA2C,SAA0B,mBAA4B,QAAsC;AACvJ,cAAM,SAAS,QAAQ,UAAS;AAChC,YAAI;AACJ,YAAI,aAAsB;AAC1B,YAAI,WAAmB;AACvB,YAAI,MAAM,QAAQ,IAAI,GAAG;AACrB,mBAAS,QAAQ,GAAG,QAAQ,KAAK,QAAQ,SAAS;AAC9C,kBAAM,OAAO,KAAK,KAAK;AACvB,mBAAO,SAAS,WAAW,IAAI;AAE/B,oBAAQ,QAAQ,KAAK;AACrB,oBAAQ,SAAS,KAAK;AAEtB,0BAAc,KAAK,SAAS,KAAK,eAAe,KAAK,cAAc,MAAM,QAAQ;AAEjF,mBAAO,aAAa,KAAK,YAAY;AAErC,qBAAS,gBAAgB,QAAQ,SAAS,MAAM,MAAM,YAAY,GAAG,IAAI,KAAK;AAE9E,gBAAI,CAAC,KAAK,YAAY,KAAK,gBAAgB,GAAG;AAC1C,qBAAO,0BAA0B,OAAO;YAC5C,OAAO;AACH,yBAAW,KAAK,cAAc;YAClC;UACJ;QACJ,OAAO;AACH,gBAAM,OAAO;AACb,iBAAO,SAAS,WAAW,IAAI;AAE/B,kBAAQ,QAAQ,KAAK;AACrB,kBAAQ,SAAS,KAAK;AAEtB,cAAI,mBAAmB;AACnB,iBAAK,sBAAsB,IAAI,oBAAmB;UACtD;AAEA,wBAAc,KAAK,SAAS,KAAK,eAAe,KAAK,cAAc,MAAM,QAAQ;AACjF,iBAAO,aAAa,KAAK,YAAY;AAErC,mBAAS,gBAAgB,QAAQ,SAAS,MAAM,MAAM,YAAY,CAAC;AAEnE,cAAI,CAAC,KAAK,YAAY,KAAK,gBAAgB,GAAG;AAE1C,mBAAO,0BAA0B,SAAS,KAAK;UACnD,OAAO;AACH,uBAAW,KAAK,cAAc;UAClC;QACJ;AACA,eAAO,yBAAyB,SAAS,YAAY,QAAQ;AAC7D,gBAAQ,UAAU;AAClB,gBAAQ,mBAAmB,gBAAgB,OAAO;AAClD,gBAAQ,mBAAmB,MAAK;AAEhC,YAAI,QAAQ;AACR,iBAAO,EAAE,OAAO,MAAM,OAAO,QAAQ,OAAO,MAAM,MAAM,MAAM,QAAO,CAAE;QAC3E;MACJ;;;;;;;MAQO,SACH,MACA,SACA,UAA+G;AAE/G,cAAM,OAAO,SAAS,WAAW,IAAI;AAErC,cAAM,cAAc,KAAK,SAAS,KAAK,eAAe,KAAK,cAAc,MAAM,QAAQ,mBAAmB,KAAK,IAAI,KAAK,OAAO,KAAK,MAAM,KAAM,KAAK,cAAc,MAAO;AAC1K,iBAAS,KAAK,OAAO,KAAK,QAAQ,YAAY,KAAK,UAAU,MAAK;AAC9D,mBAAS,gBAAgB,QAAQ,UAAS,GAAI,SAAS,MAAM,MAAM,YAAY,CAAC;QACpF,CAAC;MACL;;;;",
  "names": []
}
