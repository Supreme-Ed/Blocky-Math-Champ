{
  "version": 3,
  "sources": ["../../../dev/core/src/AudioV2/abstractAudio/audioBus.ts", "../../../dev/core/src/AudioV2/webAudio/webAudioBus.ts"],
  "sourcesContent": ["import type { Nullable } from \"../../types\";\nimport type { IAbstractAudioBusOptions } from \"./abstractAudioBus\";\nimport { AbstractAudioBus } from \"./abstractAudioBus\";\nimport type { AudioEngineV2 } from \"./audioEngineV2\";\nimport type { MainAudioBus } from \"./mainAudioBus\";\nimport type { AbstractSpatialAudio, ISpatialAudioOptions } from \"./subProperties/abstractSpatialAudio\";\nimport type { AbstractStereoAudio, IStereoAudioOptions } from \"./subProperties/abstractStereoAudio\";\n\n// NB: Secondary audio buses will be added later.\nexport type PrimaryAudioBus = MainAudioBus | AudioBus;\n\n/**\n * Options for creating an audio bus.\n */\nexport interface IAudioBusOptions extends IAbstractAudioBusOptions, ISpatialAudioOptions, IStereoAudioOptions {\n    /**\n     * The output bus of the audio bus. Defaults to the audio engine's default main bus.\n     * @see {@link AudioEngineV2.defaultMainBus}\n     */\n    outBus: PrimaryAudioBus;\n}\n\n/**\n * Abstract class for an audio bus that has spatial audio and stereo output capabilities.\n *\n * Instances of this class can be connected to other audio buses.\n *\n * Audio buses are created by the {@link CreateAudioBusAsync} function.\n */\nexport abstract class AudioBus extends AbstractAudioBus {\n    private _outBus: Nullable<PrimaryAudioBus> = null;\n\n    protected constructor(name: string, engine: AudioEngineV2) {\n        super(name, engine);\n    }\n\n    /**\n     * The output bus of the audio bus. Defaults to the audio engine's default main bus.\n     */\n    public get outBus(): Nullable<PrimaryAudioBus> {\n        return this._outBus;\n    }\n\n    public set outBus(outBus: Nullable<PrimaryAudioBus>) {\n        if (this._outBus === outBus) {\n            return;\n        }\n\n        if (this._outBus) {\n            this._outBus.onDisposeObservable.removeCallback(this._onOutBusDisposed);\n\n            if (!this._disconnect(this._outBus)) {\n                throw new Error(\"Disconnect failed\");\n            }\n        }\n\n        this._outBus = outBus;\n\n        if (this._outBus) {\n            this._outBus.onDisposeObservable.add(this._onOutBusDisposed);\n\n            if (!this._connect(this._outBus)) {\n                throw new Error(\"Connect failed\");\n            }\n        }\n    }\n\n    /**\n     * The spatial features of the audio bus.\n     */\n    public abstract readonly spatial: AbstractSpatialAudio;\n\n    /**\n     * The stereo features of the audio bus.\n     */\n    public abstract readonly stereo: AbstractStereoAudio;\n\n    /**\n     * Releases associated resources.\n     */\n    public override dispose(): void {\n        super.dispose();\n        this._outBus = null;\n    }\n\n    private _onOutBusDisposed = () => {\n        this.outBus = this.engine.defaultMainBus;\n    };\n}\n", "import type { Nullable } from \"core/types\";\nimport type { AbstractAudioNode } from \"../abstractAudio/abstractAudioNode\";\nimport type { IAudioBusOptions } from \"../abstractAudio/audioBus\";\nimport { AudioBus } from \"../abstractAudio/audioBus\";\nimport { _HasSpatialAudioOptions } from \"../abstractAudio/subProperties/abstractSpatialAudio\";\nimport type { _SpatialAudio } from \"../abstractAudio/subProperties/spatialAudio\";\nimport { _StereoAudio } from \"../abstractAudio/subProperties/stereoAudio\";\nimport { _WebAudioBusAndSoundSubGraph } from \"./subNodes/webAudioBusAndSoundSubGraph\";\nimport { _SpatialWebAudio } from \"./subProperties/spatialWebAudio\";\nimport type { _WebAudioEngine } from \"./webAudioEngine\";\nimport type { IWebAudioInNode, IWebAudioSuperNode } from \"./webAudioNode\";\n\n/** @internal */\nexport class _WebAudioBus extends AudioBus implements IWebAudioSuperNode {\n    private _spatial: Nullable<_SpatialAudio> = null;\n    private readonly _spatialAutoUpdate: boolean = true;\n    private readonly _spatialMinUpdateTime: number = 0;\n    private _stereo: Nullable<_StereoAudio> = null;\n\n    protected _subGraph: _WebAudioBusAndSoundSubGraph;\n\n    /** @internal */\n    public override readonly engine: _WebAudioEngine;\n\n    /** @internal */\n    public constructor(name: string, engine: _WebAudioEngine, options: Partial<IAudioBusOptions>) {\n        super(name, engine);\n\n        if (typeof options.spatialAutoUpdate === \"boolean\") {\n            this._spatialAutoUpdate = options.spatialAutoUpdate;\n        }\n\n        if (typeof options.spatialMinUpdateTime === \"number\") {\n            this._spatialMinUpdateTime = options.spatialMinUpdateTime;\n        }\n\n        this._subGraph = new _WebAudioBus._SubGraph(this);\n    }\n\n    /** @internal */\n    public async _init(options: Partial<IAudioBusOptions>): Promise<void> {\n        if (options.outBus) {\n            this.outBus = options.outBus;\n        } else {\n            await this.engine.isReadyPromise;\n            this.outBus = this.engine.defaultMainBus;\n        }\n\n        await this._subGraph.init(options);\n\n        if (_HasSpatialAudioOptions(options)) {\n            this._initSpatialProperty();\n        }\n\n        this.engine._addNode(this);\n    }\n\n    /** @internal */\n    public override dispose(): void {\n        super.dispose();\n\n        this._spatial = null;\n        this._stereo = null;\n\n        this.engine._removeNode(this);\n    }\n\n    /** @internal */\n    public get _inNode() {\n        return this._subGraph._inNode;\n    }\n\n    /** @internal */\n    public get _outNode() {\n        return this._subGraph._outNode;\n    }\n\n    /** @internal */\n    public override get spatial(): _SpatialAudio {\n        if (this._spatial) {\n            return this._spatial;\n        }\n        return this._initSpatialProperty();\n    }\n\n    /** @internal */\n    public override get stereo(): _StereoAudio {\n        return this._stereo ?? (this._stereo = new _StereoAudio(this._subGraph));\n    }\n\n    /** @internal */\n    public getClassName(): string {\n        return \"_WebAudioBus\";\n    }\n\n    protected override _connect(node: IWebAudioInNode): boolean {\n        const connected = super._connect(node);\n\n        if (!connected) {\n            return false;\n        }\n\n        if (node._inNode) {\n            this._outNode?.connect(node._inNode);\n        }\n\n        return true;\n    }\n\n    protected override _disconnect(node: IWebAudioInNode): boolean {\n        const disconnected = super._disconnect(node);\n\n        if (!disconnected) {\n            return false;\n        }\n\n        if (node._inNode) {\n            this._outNode?.disconnect(node._inNode);\n        }\n\n        return true;\n    }\n\n    private _initSpatialProperty(): _SpatialAudio {\n        if (!this._spatial) {\n            this._spatial = new _SpatialWebAudio(this._subGraph, this._spatialAutoUpdate, this._spatialMinUpdateTime);\n        }\n\n        return this._spatial;\n    }\n\n    private static _SubGraph = class extends _WebAudioBusAndSoundSubGraph {\n        protected override _owner: _WebAudioBus;\n\n        protected get _downstreamNodes(): Nullable<Set<AbstractAudioNode>> {\n            return this._owner._downstreamNodes ?? null;\n        }\n\n        protected get _upstreamNodes(): Nullable<Set<AbstractAudioNode>> {\n            return this._owner._upstreamNodes ?? null;\n        }\n    };\n}\n"],
  "mappings": "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",
  "names": []
}
